<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Andon Monitoring Realtime</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">

  <h1 class="text-2xl font-bold mb-4 text-center">üìä Andon Monitoring Realtime</h1>

  <!-- Monitoring -->
  <div id="monitoring" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>

  <!-- Kontrol -->
  <h2 class="text-xl font-semibold mb-2">‚öôÔ∏è Kontrol Mesin</h2>
  <div id="controls" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>

  <!-- QC Log -->
  <h2 class="text-xl font-semibold mb-2">üìã QC Log</h2>
  <div id="qc-log" class="overflow-x-auto">
    <table class="table-auto border-collapse border border-gray-600 w-full text-sm">
      <thead>
        <tr class="bg-gray-700">
          <th class="border border-gray-600 px-2 py-1">Mesin</th>
          <th class="border border-gray-600 px-2 py-1">Status</th>
          <th class="border border-gray-600 px-2 py-1">Waktu</th>
        </tr>
      </thead>
      <tbody id="qcLogTable"></tbody>
    </table>
  </div>

  <script>
    // üî• Konfigurasi Firebase (ganti dengan punyamu dari Firebase Console)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Init Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Data mesin awal
    let mesinList = [
      { id: 1, nama: "Mesin 1", status: "RUNNING", updatedAt: null, qcStart: null },
      { id: 2, nama: "Mesin 2", status: "STOP", updatedAt: null, qcStart: null },
      { id: 3, nama: "Mesin 3", status: "RUNNING", updatedAt: null, qcStart: null },
      { id: 4, nama: "Mesin 4", status: "STOP", updatedAt: null, qcStart: null }
    ];

    // Simpan awal ke Firebase kalau kosong
    firebase.database().ref("mesinList").once("value", (snapshot) => {
      if (!snapshot.exists()) {
        firebase.database().ref("mesinList").set(mesinList);
      }
    });

    // Listener realtime Firebase
    firebase.database().ref("mesinList").on("value", (snapshot) => {
      if (snapshot.exists()) {
        mesinList = snapshot.val();
        renderMonitoring();
        renderControls();
        renderQCLog();
      }
    });

    // Update status ke Firebase
    function updateStatus(index, status) {
      mesinList[index].status = status;
      mesinList[index].updatedAt = new Date().toISOString();
      if (status === "CEK QC FIRST SAMPLE" || status === "PROBLEM QUALITY") {
        mesinList[index].qcStart = new Date().toISOString();
      } else {
        mesinList[index].qcStart = null;
      }

      firebase.database().ref("mesinList").set(mesinList);
    }

    // Render Monitoring
    function renderMonitoring() {
      const container = document.getElementById("monitoring");
      container.innerHTML = "";
      mesinList.forEach((mesin) => {
        const warna =
          mesin.status === "RUNNING" ? "bg-green-600" :
          mesin.status === "STOP" ? "bg-red-600" :
          mesin.status === "CEK QC FIRST SAMPLE" ? "bg-yellow-500" :
          "bg-purple-600";

        container.innerHTML += `
          <div class="p-4 rounded-xl shadow-lg text-center ${warna}">
            <h3 class="font-bold text-lg">${mesin.nama}</h3>
            <p class="text-sm">${mesin.status}</p>
            <p class="text-xs mt-1">${mesin.updatedAt ? new Date(mesin.updatedAt).toLocaleTimeString() : "-"}</p>
          </div>
        `;
      });
    }

    // Render Controls
    function renderControls() {
      const container = document.getElementById("controls");
      container.innerHTML = "";
      mesinList.forEach((mesin, index) => {
        container.innerHTML += `
          <div class="p-3 border border-gray-700 rounded-xl">
            <h3 class="font-bold mb-2">${mesin.nama}</h3>
            <button class="bg-green-500 px-2 py-1 rounded mr-1" onclick="updateStatus(${index}, 'RUNNING')">RUN</button>
            <button class="bg-red-500 px-2 py-1 rounded mr-1" onclick="updateStatus(${index}, 'STOP')">STOP</button>
            <button class="bg-yellow-500 px-2 py-1 rounded mr-1" onclick="updateStatus(${index}, 'CEK QC FIRST SAMPLE')">QC</button>
            <button class="bg-purple-600 px-2 py-1 rounded" onclick="updateStatus(${index}, 'PROBLEM QUALITY')">PROBLEM</button>
          </div>
        `;
      });
    }

    // Render QC Log
    function renderQCLog() {
      const table = document.getElementById("qcLogTable");
      table.innerHTML = "";
      mesinList.forEach((mesin) => {
        if (mesin.qcStart) {
          table.innerHTML += `
            <tr>
              <td class="border border-gray-600 px-2 py-1">${mesin.nama}</td>
              <td class="border border-gray-600 px-2 py-1">${mesin.status}</td>
              <td class="border border-gray-600 px-2 py-1">${new Date(mesin.qcStart).toLocaleTimeString()}</td>
            </tr>
          `;
        }
      });
    }
  </script>
</body>
</html>

